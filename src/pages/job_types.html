<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GNFC | Job Type Analysis</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            bg: '#0f1115',
                            panel: '#181b21',
                            header: '#1f242b',
                            border: '#2a2e36',
                            text: '#e2e8f0',
                            muted: '#94a3b8'
                        },
                        gnfc: {
                            blue: '#3b82f6',
                            orange: '#f97316',
                            green: '#22c55e'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #0f1115; }
        ::-webkit-scrollbar-thumb { background: #2a2e36; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #3b82f6; }

        .table-sticky-header th {
            position: sticky;
            top: 0;
            z-index: 10;
        }
    </style>
</head>

<body class="bg-dark-bg text-dark-text h-screen flex overflow-hidden">

  <script src="/src/js/theme_manager.js"></script>
    <script src="/src/js/sidebar.js"></script>
  <script src="/src/js/header.js"></script>

  <div id="sidebar-container"></div>
    <script>try { renderSidebar('technician_logbook'); } catch (e) { }</script>

    <main class="flex-1 flex flex-col h-screen overflow-hidden">
        <div id="header-container"></div>
        <script>
            renderHeader({
                title: "Job Type Analysis",
                breadcrumbs: [
                    { label: "Technician Log", href: "technician_logbook.html" },
                    { label: "Plant Detail", href: "plant_detail.html" },
                    { label: "Job Type Analysis" }
                ],
                backLink: "plant_detail.html"
            });
        </script>

        <div class="flex-1 overflow-y-auto p-4 bg-dark-bg">
      <!-- Top Navigation Bar -->
      <div id="plant-nav-container"></div>
      <script src="/src/js/plant_nav.js"></script>
      <script>
        renderPlantNav('job_types');
      </script>

            <div class="bg-dark-panel border border-dark-border rounded my-4 shadow-sm">
                <div class="px-4 py-3 border-b border-dark-border bg-dark-header flex justify-between items-center">
                    <div class="flex items-center gap-2 text-sm font-bold uppercase tracking-wide">
                        <i class="ph-bold ph-funnel text-gnfc-blue"></i> Filter Query
                    </div>
                </div>

                <div class="p-4 grid grid-cols-1 md:grid-cols-12 gap-4 items-end">
                    <div class="md:col-span-5">
                        <label class="block text-[12px] uppercase font-bold text-dark-muted mb-1.5">Time Range</label>
                        <div class="flex bg-dark-bg border border-dark-border rounded-md h-10 items-center px-3">
                            <input type="date" id="start-date" class="bg-transparent text-sm focus:outline-none w-full">
                            <span class="px-2 text-dark-muted font-bold">-</span>
                            <input type="date" id="end-date" class="bg-transparent text-sm focus:outline-none w-full">
                        </div>
                    </div>

                    <div class="md:col-span-4">
                        <label class="block text-[12px] uppercase font-bold text-dark-muted mb-1.5">Job Category</label>
                        <select id="job-type-select" class="bg-dark-bg border border-dark-border text-sm rounded-md h-10 w-full px-3 outline-none">
                            <option value="">All Categories</option>
                            <option value="PM">Preventive Maint (PM)</option>
                            <option value="BREAKDOWN">Breakdown</option>
                            <option value="DEFECT">Defect Maintenance</option>
                        </select>
                    </div>

                    <div class="md:col-span-3 flex gap-2">
                        <button onclick="applyFilters()" class="h-10 px-4 flex-1 bg-gnfc-blue  text-sm font-bold rounded-md shadow-lg shadow-blue-500/20 hover:bg-blue-500">Run</button>
                        <button onclick="resetFilters()" class="h-10 px-4 bg-transparent border border-dark-border text-dark-muted rounded-md hover:border-white/20">Clear</button>
                    </div>
                </div>
            </div>

            <div class="bg-dark-panel border border-dark-border rounded-md shadow-sm overflow-hidden">
                <div class="px-4 py-3 border-b border-dark-border flex justify-between items-center bg-dark-header">
                    <h3 class="font-bold text-sm flex items-center gap-2">
                        <i class="ph-fill ph-clipboard-text text-gnfc-blue"></i>
                        Last 40 Days Log Book Report
                    </h3>
                    <span class="text-xs font-mono font-bold text-gnfc-blue bg-gnfc-blue/10 px-2 py-1 rounded border border-gnfc-blue/20" id="item-count">0 Records</span>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse table-sticky-header">
                        <thead>
                            <tr class="bg-dark-bg text-[12px] font-bold text-dark-muted uppercase tracking-widest text-center border-b border-dark-border">
                                <th rowspan="2" class="border-r border-dark-border px-3 py-3 w-12">Sr</th>
                                <th rowspan="2" class="border-r border-dark-border px-3 py-3 w-20">Area</th>
                                <th class="border-r border-dark-border px-3 py-2 w-48 border-b border-dark-border ">Loop No</th>
                                <th class="border-r border-dark-border px-3 py-2 min-w-[200px] border-b border-dark-border ">Job</th>
                                <th rowspan="2" class="border-r border-dark-border px-3 py-3 w-20">Tech</th>
                                <th rowspan="2" class="border-r border-dark-border px-4 py-3 min-w-[350px] text-left">Description</th>
                                <th rowspan="2" class="border-r border-dark-border px-3 py-3 w-24">Tech</th>
                                <th rowspan="2" class="border-r border-dark-border px-3 py-3 w-28">Status</th>
                                <th rowspan="2" class="px-3 py-3 min-w-[100px]">Remarks</th>
                            </tr>
                            <tr class="bg-dark-bg text-[9px] font-bold text-gnfc-blue uppercase text-center border-b border-dark-border">
                                <th class="border-r border-dark-border px-3 py-1">Tag No</th>
                                <th class="border-r border-dark-border px-3 py-1">Type of Job</th>
                            </tr>
                        </thead>
                        <tbody id="plantTableBody" class="text-xs font-mono">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <script>
        const jobTypeData = [
            { sr: '1', date: '15/02/2026', area: '100', tag: 'N.A', tagSubtitle: 'MOLSIEVE ADSORBER', jobType: 'A104A/B Molsieve adsorber flushing', jobRef: 'PM', tech: 'PJR', desc: 'A104A/B Molsieve adsorber condensate flushing was done.', engineer: 'MAJ', status: '✓ OVER' },
            { sr: '2', date: '15/02/2026', area: 'N.A', tag: 'N.A', tagSubtitle: 'DCS/ESD system', jobType: 'Routine DCS/ESD System checking', jobRef: 'PM', tech: 'NND', desc: 'System round taken.', engineer: 'MAJ', status: '✓ OVER' },
            { sr: '3', date: '15/02/2026', area: 'N.A', tag: 'N.A', tagSubtitle: 'ANA-A1', jobType: 'Analyzer Sample/Bypass Flow check', jobRef: 'PM', tech: 'PJR', desc: 'Analyzer Sample/Bypass Flow and Pressure checked.', engineer: 'MAJ', status: '✓ OVER' },
            { sr: '4', date: '15/02/2026', area: 'N.A', tag: 'N.A', tagSubtitle: 'ANALYZER ROUND', jobType: 'Analyzer healthiness check', jobRef: 'PM', tech: 'PJR', desc: 'Analyzer round taken and no abnormality found.', engineer: 'MAJ', status: '✓ OVER' },
            { sr: '5', date: '15/02/2026', area: 'N.A', tag: 'N.A', tagSubtitle: 'DCS/ESD system', jobType: 'N.A', jobRef: 'PM', tech: 'NND', desc: 'System round taken.', engineer: 'MAJ', status: '✓ OVER' },
            { sr: '6', date: '14/02/2026', area: 'N.A', tag: 'N.A', tagSubtitle: 'ESD-FSC1', jobType: 'DEFECT MAINTENANCE', jobRef: 'DEFECT', tech: 'PSG', desc: '-LIS1077 faulty alarm appeared in ESD-FSC1 reset done.', engineer: 'NKP', status: '✓ OVER' },
            { sr: '7', date: '14/02/2026', area: 'N.A', tag: 'N.A', tagSubtitle: 'DCS/ESD system', jobType: 'Routine checking', jobRef: 'PM', tech: 'NND', desc: 'System round taken.', engineer: 'MAJ', status: '✓ OVER' },
            { sr: '8', date: '14/02/2026', area: '400', tag: 'PT-4001', tagSubtitle: 'STEAM HEADER', jobType: 'Calibration', jobRef: 'BREAKDOWN', tech: 'GAZ', desc: 'Zero drift corrected using HART.', engineer: 'PJR', status: '✓ OVER' },
            { sr: '9', date: '13/02/2026', area: '200', tag: 'FV-0208', tagSubtitle: 'FEED LINE', jobType: 'Gland Tightening', jobRef: 'DEFECT', tech: 'MRL', desc: 'Online gland tightening performed.', engineer: 'MR_', status: '✓ OVER' },
            { sr: '10', date: '13/02/2026', area: '700', tag: 'N.A', tagSubtitle: 'UPS SYSTEM', jobType: 'Battery Health Check', jobRef: 'PM', tech: 'NND', desc: 'Voltage health check done.', engineer: 'MAJ', status: '✓ OVER' },
            { sr: '11', date: '12/02/2026', area: '100', tag: 'LV-1002', tagSubtitle: 'REFRESH TANK', jobType: 'Stroke Checking', jobRef: 'PM', tech: 'PJR', desc: 'Valve stroke confirmed from DCS.', engineer: 'NKP', status: '✓ OVER' },
            { sr: '12', date: '12/02/2026', area: '200', tag: 'HV-0207', tagSubtitle: 'REACTOR', jobType: 'SOV Replacement', jobRef: 'BREAKDOWN', tech: 'GAZ', desc: 'SOV coil replaced and tested.', engineer: 'PJR', status: 'U/P' }
        ];

        function applyFilters() {
            const jobType = document.getElementById('job-type-select').value;
            const startDateInput = document.getElementById('start-date').value;
            const endDateInput = document.getElementById('end-date').value;

            let filtered = jobTypeData;

            if (jobType) {
                filtered = filtered.filter(item => item.jobRef === jobType);
            }

            if (startDateInput || endDateInput) {
                const start = startDateInput ? new Date(startDateInput) : null;
                const end = endDateInput ? new Date(endDateInput) : null;
                if (start) start.setHours(0,0,0,0);
                if (end) end.setHours(23,59,59,999);

                filtered = filtered.filter(item => {
                    const [d, m, y] = item.date.split('/').map(Number);
                    const itemDate = new Date(y, m - 1, d);
                    if (start && itemDate < start) return false;
                    if (end && itemDate > end) return false;
                    return true;
                });
            }

            renderTable(filtered);
        }

        function resetFilters() {
            document.getElementById('start-date').value = '';
            document.getElementById('end-date').value = '';
            document.getElementById('job-type-select').value = '';
            renderTable(jobTypeData);
        }

        function renderTable(data) {
            const tbody = document.getElementById('plantTableBody');
            const countLabel = document.getElementById('item-count');
            tbody.innerHTML = '';
            countLabel.textContent = `${data.length} Records`;

            // Grouping by Date
            const grouped = data.reduce((acc, item) => {
                if (!acc[item.date]) acc[item.date] = [];
                acc[item.date].push(item);
                return acc;
            }, {});

            const sortedDates = Object.keys(grouped).sort((a, b) => {
                const [d1, m1, y1] = a.split('/').map(Number);
                const [d2, m2, y2] = b.split('/').map(Number);
                return new Date(y2, m2 - 1, d2) - new Date(y1, m1 - 1, d1);
            });

            sortedDates.forEach(date => {
                // Header row for Date
                tbody.innerHTML += `
                    <tr class="bg-dark-panel border-y border-dark-border">
                        <td colspan="9" class="px-4 py-2 font-bold text-[12px] text-gnfc-orange uppercase tracking-widest bg-dark-header">
                            <div class="flex items-center gap-2">
                                <i class="ph ph-calendar-blank text-base"></i> ${date}
                            </div>
                        </td>
                    </tr>`;

                grouped[date].forEach(item => {
                    const statusColor = item.status.includes('OVER') ? 'text-gnfc-green' : 'text-gnfc-orange';
                    
                    tbody.innerHTML += `
                        <tr class="hover:bg-white/5 border-b border-dark-border transition-colors">
                            <td class="border-r border-dark-border px-2 py-3 text-center text-dark-muted">${item.sr}</td>
                            <td class="border-r border-dark-border px-2 py-3 text-center font-bold text-gnfc-blue">${item.area}</td>
                            <td class="border-r border-dark-border px-3 py-3">
                                <div class="font-bold text-dark-text">${item.tag}</div>
                                <div class="text-[12px] text-dark-muted mt-1">${item.tagSubtitle}</div>
                            </td>
                            <td class="border-r border-dark-border px-3 py-3">
                                <div class="">${item.jobType}</div>
                                <div class="text-[12px] font-black text-gnfc-orange uppercase mt-1 tracking-tighter">${item.jobRef}</div>
                            </td>
                            <td class="border-r border-dark-border px-2 py-3 text-center font-bold">${item.tech}</td>
                            <td class="border-r border-dark-border px-4 py-3 text-xs leading-relaxed opacity-80">${item.desc}</td>
                            <td class="border-r border-dark-border px-2 py-3 text-center">
                                <div class="text-[12px] font-bold pb-1 mb-1">${item.tech}</div>
                            </td>
                            <td class="border-r border-dark-border px-2 py-3 text-center ${statusColor} font-black text-[12px]">${item.status}</td>
                            <td class="px-2 py-3"></td>
                        </tr>`;
                });
            });
        }

        document.addEventListener('DOMContentLoaded', () => renderTable(jobTypeData));
    </script>
</body>
</html>