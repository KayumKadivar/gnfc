<!DOCTYPE html>
<html lang="en" class="dark">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GNFC | Acetic Acid Logbook</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <script src="https://unpkg.com/micromodal/dist/micromodal.min.js"></script>
  <style>
    /* MicroModal Animation Styles */
    .modal { display: none; }
    .modal.is-open { display: block; }
    
    .modal__overlay {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6); display: flex;
      justify-content: center; align-items: center; z-index: 100;
      backdrop-filter: blur(4px);
    }
    
    .modal__container {
      background-color: var(--app-panel);
      max-width: 90vw; max-height: 90vh; border-radius: 4px;
      overflow-y: auto; box-sizing: border-box; border: 1px solid var(--app-border);
      color: var(--app-text);
    }

    @keyframes mmfadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes mmfadeOut { from { opacity: 1; } to { opacity: 0; } }
    @keyframes mmslideIn { from { transform: translateY(15%); } to { transform: translateY(0); } }
    @keyframes mmslideOut { from { transform: translateY(0); } to { transform: translateY(-10%); } }

    .micromodal-slide { display: none; }
    .micromodal-slide.is-open { display: block; }
    .micromodal-slide[aria-hidden="false"] .modal__overlay { animation: mmfadeIn .3s cubic-bezier(0.0, 0.0, 0.2, 1); }
    .micromodal-slide[aria-hidden="false"] .modal__container { animation: mmslideIn .3s cubic-bezier(0, 0, .2, 1); }
    .micromodal-slide[aria-hidden="true"] .modal__overlay { animation: mmfadeOut .3s cubic-bezier(0.0, 0.0, 0.2, 1); }
    .micromodal-slide[aria-hidden="true"] .modal__container { animation: mmslideOut .3s cubic-bezier(0, 0, .2, 1); }
    .micromodal-slide .modal__container, .micromodal-slide .modal__overlay { will-change: transform; }

    /* Force full-contrast typography for this page across theme modes */
    html[data-theme-mode="light"] .theme-contrast-lock,
    html[data-theme-mode="light"] .theme-contrast-lock * {
      color: #000000 !important;
    }

    html[data-theme-mode="dark"] .theme-contrast-lock,
    html[data-theme-mode="dark"] .theme-contrast-lock * {
      color: #ffffff;
    }

    html[data-theme-mode="light"] .theme-contrast-lock input::placeholder,
    html[data-theme-mode="light"] .theme-contrast-lock textarea::placeholder {
      color: rgba(0, 0, 0, 0.7) !important;
    }

    html[data-theme-mode="dark"] .theme-contrast-lock input::placeholder,
    html[data-theme-mode="dark"] .theme-contrast-lock textarea::placeholder {
      color: rgba(255, 255, 255, 0.7) !important;
    }

    /* High-Specificity Override: Force white text even inside theme-contrast-lock */
    html[data-theme-mode] .theme-contrast-lock .text-white-force,
    html[data-theme-mode] .theme-contrast-lock .text-white-force * {
      color: #ffffff !important;
    }

    /* Keep row transition only; hover look comes from table row utility classes */
    #plant-table tbody tr {
      transition: background-color .18s ease;
    }
  </style>
  <script src="/src/js/tailwind_config.js"></script>
</head>

<body
  class="bg-dark-bg text-dark-text font-sans h-screen flex overflow-hidden selection:bg-gnfc-blue selection:text-white">
  
  <script src="/src/js/theme_manager.js"></script>
  <script src="/src/js/sidebar.js"></script>
  <script src="/src/js/header.js"></script>
  <div id="sidebar-container"></div>
  <script>
    // Try render sidebar if script exists
    try { renderSidebar('technician_logbook'); } catch (e) { }
  </script>

  <main class="theme-contrast-lock flex-1 flex flex-col h-screen overflow-hidden">

    <div id="header-container"></div>
    <script>
        renderHeader({
            title: "Acetic Acid Logbook",
            breadcrumbs: [
                { label: "Technician Log", href: "/src/pages/technician_logbook.html" },
                { label: "Plant Detail" }
            ],
            backLink: "/src/pages/technician_logbook.html"
        });
    </script>

    <div class="p-3 bg-dark-bg space-y-3">
      <div class="bg-dark-panel rounded-sm border border-dark-border shadow-sm ">
        <div class="bg-dark-panel border-b border-dark-border px-2">
          <div class="flex overflow-x-auto gap-1 py-2 scrollbar-none">
            <button onclick="window.location.href='/src/pages/job_types.html'" data-target="job_types.html"
               class="px-3 py-1.5 text-xs font-medium rounded-sm whitespace-nowrap bg-slate-200 text-slate-900 hover:bg-slate-700 hover:text-slate-200 dark:bg-slate-600 dark:text-slate-900 dark:hover:bg-slate-500 transition-colors">Type
              Of Job</button>
            <button onclick="window.location.href='/src/pages/instrument_types.html'" data-target="instrument_types.html"
              class="px-3 py-1.5 text-xs font-medium rounded-sm whitespace-nowrap bg-slate-200 text-slate-900 hover:bg-slate-700 hover:text-slate-200 dark:bg-slate-600 dark:text-slate-900 dark:hover:bg-slate-500 transition-colors">Type
              Of Inst</button>
            <button onclick="window.location.href='/src/pages/remark_reports.html'" data-target="remark_reports.html"
              class="px-3 py-1.5 text-xs font-medium rounded-sm whitespace-nowrap bg-slate-200 text-slate-900 hover:bg-slate-700 hover:text-slate-200 dark:bg-slate-600 dark:text-slate-900 dark:hover:bg-slate-500 transition-colors">Remark
              Report</button>
            <button onclick="window.location.href='/src/pages/tagwise_filter.html'" data-target="tagwise_filter.html"
              class="px-3 py-1.5 text-xs font-medium rounded-sm whitespace-nowrap bg-slate-200 text-slate-900 hover:bg-slate-700 hover:text-slate-200 dark:bg-slate-600 dark:text-slate-900 dark:hover:bg-slate-500 transition-colors">TagWise
              Filter</button>
            <button onclick="window.location.href='/src/pages/monthly_report.html'" data-target="monthly_report.html"
              class="px-3 py-1.5 text-xs font-medium rounded-sm whitespace-nowrap bg-slate-200 text-slate-900 hover:bg-slate-700 hover:text-slate-200 dark:bg-slate-600 dark:text-slate-900 dark:hover:bg-slate-500 transition-colors">Monthly
              Report</button>
            <button onclick="window.location.href='/src/pages/job_history.html'" data-target="job_history.html"
              class="px-3 py-1.5 text-xs font-medium rounded-sm whitespace-nowrap bg-slate-200 text-slate-900 hover:bg-slate-700 hover:text-slate-200 dark:bg-slate-600 dark:text-slate-900 dark:hover:bg-slate-500 transition-colors">Job
              History</button>
            <button onclick="EmgCallModal.open()" data-target="emg_modal.html"
              class="text-white-force px-3 py-1.5 text-xs font-bold rounded-sm whitespace-nowrap flex items-center gap-1 bg-red-600 hover:bg-red-700 transition-colors">
              <i class="ph-bold ph-siren"></i> EMG Call
            </button>
          </div>
        </div>

        <div class="p-3 bg-white dark:bg-dark-panel flex flex-wrap items-center justify-between gap-3 ">
          <div class="flex bg-slate-100 dark:bg-dark-panel border border-slate-200 dark:border-dark-border rounded-sm p-0.5">
            <button id="btn-tomorrow"
              class="tab-btn px-4 py-1 text-xs font-medium text-slate-500 dark:text-dark-muted hover:text-slate-700 dark:hover:text-white transition-colors"
              onclick="switchView(this, 'tomorrow')">Tomorrow</button>
            <button id="btn-today"
              class="tab-btn px-4 py-1 text-xs font-bold text-blue-600 dark:text-gnfc-orange bg-white dark:bg-[#323232] shadow-sm border border-slate-200 dark:border-dark-border rounded-sm transition-colors"
              onclick="switchView(this, 'today')">Today</button>
            <button id="btn-prev"
              class="tab-btn px-4 py-1 text-xs font-medium text-slate-500 dark:text-dark-muted hover:text-slate-700 dark:hover:text-white transition-colors"
              onclick="switchView(this, 'prev')">PrevDay</button>
            <div class="w-px bg-slate-300 dark:bg-dark-border my-1 mx-1"></div>
            <button id="btn-weekly"
              class="tab-btn px-4 py-1 text-xs font-medium text-slate-500 dark:text-dark-muted hover:text-slate-700 dark:hover:text-white transition-colors"
              onclick="switchView(this, 'weekly')">Weekly</button>
            <button id="btn-monthly"
              class="tab-btn px-4 py-1 text-xs font-medium text-slate-500 dark:text-dark-muted hover:text-slate-700 dark:hover:text-white transition-colors"
              onclick="switchView(this, 'monthly')">Monthly</button>
          </div>

          <div class="flex gap-2">
            <button
              class="px-3 py-1.5 bg-gnfc-orange/10 text-gnfc-orange border border-gnfc-orange/30 rounded-sm text-xs font-bold hover:bg-gnfc-orange/20 transition-colors">Pending
              Jobs</button>
            <button onclick="AddLogModal.open()"
              class="text-white-force flex items-center gap-2 px-4 py-1.5 bg-blue-600 hover:bg-gnfc-blue rounded-sm text-xs font-bold shadow-lg shadow-blue-500/10 transition-all">
              <i class="ph-bold ph-plus"></i> Add New
            </button>
          </div>
        </div>
      </div>

      <div id="job-filter-bar" class="hidden bg-dark-panel border border-dark-border rounded-sm p-3 ">
        <div class="flex flex-col md:flex-row items-center gap-4">
          <div class="flex items-center gap-2 w-full md:w-auto">
            <label class="text-[10px] font-bold text-gnfc-blue uppercase tracking-wide">Start</label>
            <input type="date" id="start-date" onchange="applyFilters()"
              class="bg-dark-bg border border-dark-border text-white text-xs rounded-sm px-2 py-1 focus:border-gnfc-blue outline-none">
          </div>

          <div class="flex items-center gap-2 w-full md:w-auto">
            <label class="text-[10px] font-bold text-gnfc-blue uppercase tracking-wide">End</label>
            <input type="date" id="end-date" onchange="applyFilters()"
              class="bg-dark-bg border border-dark-border text-white text-xs rounded-sm px-2 py-1 focus:border-gnfc-blue outline-none">
          </div>

          <div class="flex items-center gap-2 w-full md:w-auto flex-1">
            <label class="text-[10px] font-bold text-gnfc-blue uppercase tracking-wide whitespace-nowrap">Filter
              Type</label>
            <div class="relative w-full">
              <select id="job-type-select" onchange="applyFilters()"
                class="w-full bg-dark-bg border border-dark-border text-white text-xs rounded-sm px-2 py-1 appearance-none focus:border-gnfc-blue outline-none cursor-pointer">
                <option value="">All Jobs</option>
              </select>
              <i
                class="ph-bold ph-caret-down absolute right-2 top-1/2 -translate-y-1/2 text-dark-muted pointer-events-none text-xs"></i>
            </div>
          </div>

          <button onclick="toggleJobFilter()"
            class="text-xs font-bold text-gnfc-red hover:text-white transition-colors flex items-center gap-1">
            <i class="ph-bold ph-x"></i> Close
          </button>
        </div>
      </div>

      <div id="dynamic-view-container" class="bg-white dark:bg-dark-panel border border-slate-200 dark:border-dark-border rounded-sm flex flex-col">
        <div class="px-4 py-2 border-b border-slate-200 dark:border-dark-border flex justify-between items-center bg-slate-50 dark:bg-dark-panel">
          <div class="flex items-center gap-2">
            <i class="ph-fill ph-table text-blue-600 dark:text-gnfc-blue"></i>
            <span id="view-title" class="text-sm font-bold text-slate-800 dark:text-white">Today Log Book</span>
            <span id="record-count" class="ml-2 text-[10px] bg-slate-200 dark:bg-dark-bg border border-slate-300 dark:border-dark-border px-2 py-0.5 rounded text-slate-600 dark:text-dark-muted font-mono">0 Records</span>
          </div>
           
           <div class="flex items-center gap-3">
               <div class="relative">
                 <i class="ph ph-magnifying-glass absolute left-2 top-1/2 -translate-y-1/2 text-slate-400 dark:text-dark-muted text-xs"></i>
                 <input type="text" id="table-search" placeholder="Search logs..." 
                   onkeyup="plantLogTable.setSearch(this.value)"
                   class="bg-white dark:bg-dark-bg border border-slate-300 dark:border-dark-border text-slate-700 dark:text-white text-xs rounded-sm pl-7 pr-3 py-1 focus:border-blue-500 dark:focus:border-gnfc-blue focus:outline-none w-48 transition-colors">
               </div>
               <span id="view-date" class="text-xs font-mono text-blue-600 dark:text-gnfc-orange">06.02.2026</span>
           </div>
        </div>

        <div class="overflow-x-auto flex-1">
          <table id="plant-table" class="w-full text-left border-collapse">
            <thead>
              <tr
                class="bg-slate-100 dark:bg-dark-header text-[10px] font-bold text-slate-500 dark:text-dark-muted uppercase tracking-widest text-center border-b border-slate-200 dark:border-dark-border">
                <th rowspan="2" class="border-r border-dark-border p-2 w-12 cursor-pointer hover:bg-white/5 transition-colors" onclick="plantLogTable.sort('sr')">Sr <i class="ph-fill ph-caret-up-down text-[8px] ml-1"></i></th>

                <th rowspan="2" class="border-r border-dark-border p-2 w-20 cursor-pointer hover:bg-white/5 transition-colors" onclick="plantLogTable.sort('area')">Area <i class="ph-fill ph-caret-up-down text-[8px] ml-1"></i></th>

                <th class="border-r border-b px-3 py-2 w-40 border-dark-border cursor-pointer hover:bg-white/5 transition-colors" onclick="plantLogTable.sort('tag')">Loop / Tag <i class="ph-fill ph-caret-up-down text-[8px] ml-1"></i></th>

                <th class="border-r border-b px-3 py-2 min-w-[200px] border-dark-border font-black cursor-pointer hover:bg-white/5 transition-colors" onclick="plantLogTable.sort('jobType')">Job Type <i class="ph-fill ph-caret-up-down text-[8px] ml-1"></i></th>

                <th rowspan="2" class="border-r border-dark-border p-2 w-16 cursor-pointer hover:bg-white/5 transition-colors" onclick="plantLogTable.sort('tech')">Tech</th>

                <th rowspan="2" class="border-r border-dark-border p-2 min-w-[300px] hover:bg-white/5 transition-colors">Description</th>

                <th rowspan="2" class="border-r border-dark-border p-2 w-24 cursor-pointer hover:bg-white/5 transition-colors" onclick="plantLogTable.sort('engineer')">Tech/Eng</th>
                
                <th rowspan="2" class="border-r border-dark-border p-2 w-28 relative group/th">
                    <div class="flex items-center justify-between cursor-pointer hover:bg-white/5 transition-colors p-1 rounded" onclick="plantLogTable.sort('status')">
                        <span>Status</span>
                        <!-- <i class="ph-fill ph-caret-up-down text-[8px] ml-1"></i> -->
                    </div>
                    <button onclick="toggleStatusFilter(event)" class="absolute top-5 right-6 text-slate-400 hover:text-blue-500 dark:text-dark-muted dark:hover:text-white focus:outline-none p-1 rounded hover:bg-white/5">
                        <i class="ph-bold ph-funnel text-xs"></i>
                    </button>
                    <!-- Filter Dropdown -->
                    <div id="status-filter-dropdown" class="hidden absolute top-14 right-0 w-20 bg-white dark:bg-dark-panel border border-slate-200 dark:border-dark-border shadow-xl rounded-sm z-50 flex flex-col py-1">
                        <!-- Options injected by JS -->
                    </div>
                </th>
                <th rowspan="2" class="p-2 min-w-[120px] hover:bg-white/5 transition-colors">Remarks</th>
              </tr>
              <tr
                class="bg-slate-100 dark:bg-dark-header text-[10px] font-bold text-slate-500 dark:text-dark-muted uppercase tracking-widest text-center border-b border-slate-200 dark:border-dark-border">
                <th class="border-r border-dark-border p-2 hover:bg-white/5 transition-colors">Tag Detail</th>
                <th class="border-r border-dark-border p-2 hover:bg-white/5 transition-colors">Instrument Detail</th>
              </tr>
            </thead>
            <tbody id="plantTableBody" class="text-xs font-mono">
            </tbody>
          </table>
        </div>
        
        <!-- Pagination Container -->
        <div id="plant-table-pagination" class="px-4 pb-4 bg-white dark:bg-dark-panel"></div>
        
      </div>

    </div>
  </main>

  <script src="/src/js/plant_log_core.js"></script>
  <script src="/src/js/emg_call_modal.js"></script>
  <script src="/src/js/add_log_modal.js"></script>
  <script>
    // Plant Mock Data
    const plantLogData = {
      today: [
        { sr: '01', date: '06/02/2026', area: 'FA', tag: 'N.A', tagSubtitle: 'Checking', jobType: 'Routine checkup', jobRef: 'Ref:PHS : 06/02/2026', tech: 'NRK', desc: '', engineer: '', engInitials: '', status: '', statusColor: '', remarks: '' },

        { sr: '02', date: '06/02/2026', area: 'MF', tag: 'Loop-202', tagSubtitle: 'PT5087K', jobType: 'Pressure transmitter', jobRef: 'By:AMS : 06/02/2026', jobLabel: 'PM', tech: 'DPB', desc: '', engineer: '', engInitials: '', status: '', statusColor: '', remarks: '' },

        { sr: '03', date: '06/02/2026', area: 'DCS', tag: 'N.A', tagSubtitle: 'NOTAG', jobType: 'ESD System', jobRef: 'By:PHB : 06/02/2026', jobLabel: 'PM', tech: 'NRK', desc: '', engineer: '', engInitials: '', status: '', statusColor: '', remarks: '' }
      ],
      tomorrow: [],
      prev: [
        { sr: '01', date: '05/02/2026', area: 'N.A', tag: 'ISJ47FB', tagSubtitle: 'Repair', jobType: 'Field Job', jobRef: 'Ref:PHS', tech: 'NRK', desc: 'Job completed as requested.', engineer: 'NRK', engInitials: 'PHB', status: '✓ OVER', statusColor: 'green', remarks: '' },
        { sr: '02', date: '05/02/2026', area: 'N.A', tag: 'ISJ47FB', tagSubtitle: 'Repair', jobType: 'Field Job', jobRef: 'Ref:PHS', tech: 'NRK', desc: 'Job completed as requested.', engineer: 'NRK', engInitials: 'PHB', status: '✓ OVER', statusColor: 'green', remarks: '' },
        { sr: '03', date: '05/02/2026', area: 'N.A', tag: 'ISJ47FB', tagSubtitle: 'Repair', jobType: 'Field Job', jobRef: 'Ref:PHS', tech: 'NRK', desc: 'Job completed as requested.', engineer: 'NRK', engInitials: 'PHB', status: '✓ OVER', statusColor: 'green', remarks: '' },
        { sr: '04', date: '05/02/2026', area: 'N.A', tag: 'ISJ47FB', tagSubtitle: 'Repair', jobType: 'Field Job', jobRef: 'Ref:PHS', tech: 'NRK', desc: 'Job completed as requested.', engineer: 'NRK', engInitials: 'PHB', status: '✓ OVER', statusColor: 'green', remarks: 'Job completed as requested' },
      ],
      weekly: [
        { sr: '01', date: '05/02/2026', area: 'FA', tag: 'FT5021A', tagSubtitle: 'Calib', jobType: 'Routine Check', jobRef: 'Ref:PHS', tech: 'NRK', desc: 'Routine checkup completed.', engineer: '', engInitials: 'PHB', status: '✓ OVER', statusColor: 'green', remarks: 'Job completed as requested' },
        { sr: '02', date: '04/02/2026', area: 'MF', tag: 'PT5087K', tagSubtitle: 'PT5082', jobType: 'Calibration', jobRef: 'Ref:PHS', tech: 'DPB', desc: 'Calibration work completed.', engineer: 'DPB', engInitials: 'AMS', status: '✓ OVER', statusColor: 'green', remarks: '' },
        { sr: '01', date: '03/02/2026', area: 'DCS', tag: 'SYS-1', tagSubtitle: 'DCS', jobType: 'Backups', jobRef: 'Ref:System', tech: 'IT', desc: 'System backup taken.', engineer: 'IT', engInitials: 'IT', status: '✓ OVER', statusColor: 'green', remarks: 'Job completed as requested' }
      ],
      monthly: [
        { sr: '01', date: '01/02/2026', area: 'DCS', tag: 'SYS-MAIN', tagSubtitle: 'SYS', jobType: 'Monthly Maint', jobRef: 'Ref:PHS', tech: 'NRK', desc: 'Full system backup taken.', engineer: 'NRK', engInitials: 'PHB', status: '✓ OVER', statusColor: 'green', remarks: '' },
        { sr: '02', date: '25/01/2026', area: 'UTIL', tag: 'Air', tagSubtitle: 'Comp', jobType: 'Service', jobRef: 'Ref:Mec', tech: 'Mec', desc: 'Air compressor service.', engineer: 'ME', engInitials: 'XY', status: '✓ OVER', statusColor: 'green', remarks: 'Job completed as requested.' }
      ]
    };

    let currentView = 'today';
    let plantLogTable;

    function initTable() {
         plantLogTable = new PlantLogTable({
            containerId: '#plant-table',
            data: plantLogData['today'],
            itemsPerPage: 5
        });
    }

    function toggleJobFilter() {
      const filterBar = document.getElementById('job-filter-bar');
      filterBar.classList.toggle('hidden');
      if (!filterBar.classList.contains('hidden')) {
        populateJobTypeDropdown();
      }
    }

    function populateJobTypeDropdown() {
      const allData = [
        ...plantLogData.today,
        ...plantLogData.prev,
        ...plantLogData.weekly,
        ...plantLogData.monthly
      ];

      const jobTypes = [...new Set(allData.map(item => item.jobType).filter(Boolean))].sort();
      const select = document.getElementById('job-type-select');
      select.innerHTML = '<option value="">All Jobs</option>';

      jobTypes.forEach(type => {
        const option = document.createElement('option');
        option.value = type;
        option.textContent = type;
        select.appendChild(option);
      });
    }

    function applyFilters() {
      const jobType = document.getElementById('job-type-select').value;
      const startDate = document.getElementById('start-date').value;
      const endDate = document.getElementById('end-date').value;
   
      let filteredData = plantLogData[currentView] || [];

      if (jobType) filteredData = filteredData.filter(item => item.jobType === jobType);

      if (startDate || endDate) {
        filteredData = filteredData.filter(item => {
          if (!item.date) return false;
          const [d, m, y] = item.date.split('/').map(Number);
          const itemDate = new Date(y, m - 1, d);

          if (startDate) {
            const start = new Date(startDate);
            start.setHours(0, 0, 0, 0);
            if (itemDate < start) return false;
          }
          if (endDate) {
            const end = new Date(endDate);
            end.setHours(0, 0, 0, 0);
            if (itemDate > end) return false;
          }
          return true;
        });
      }
      
      // Update table data
      plantLogTable.setData(filteredData);
    }
    
    function filterStatus(status) {
        if (!plantLogTable) return;
        plantLogTable.setFilter('status', status);
        document.getElementById('status-filter-dropdown').classList.add('hidden');
    }

    function toggleStatusFilter(event) {
        event.stopPropagation(); // Prevent sorting when clicking filter
        const dropdown = document.getElementById('status-filter-dropdown');
        dropdown.classList.toggle('hidden');
        
        if (!dropdown.classList.contains('hidden')) {
            populateStatusDropdown();
            
            // Close when clicking outside
            const closeDropdown = (e) => {
                if (!e.target.closest('#status-filter-dropdown') && !e.target.closest('button[onclick="toggleStatusFilter(event)"]')) {
                    dropdown.classList.add('hidden');
                    document.removeEventListener('click', closeDropdown);
                }
            };
            document.addEventListener('click', closeDropdown);
        }
    }

    function populateStatusDropdown() {
        if (!plantLogTable) return;
        const uniqueStatuses = plantLogTable.getUniqueValues('status');
        const dropdown = document.getElementById('status-filter-dropdown');
        
        let html = `<div class="px-2 py-1 text-xs hover:bg-slate-100 dark:hover:bg-dark-border cursor-pointer select-none border-b border-slate-100 dark:border-dark-border d-flex align-start" onclick="filterStatus('')">All</div>`;
        
        uniqueStatuses.forEach(status => {
            html += `<div class="px-2 py-1 text-xs hover:bg-slate-100 dark:hover:bg-dark-border cursor-pointer select-none d-flex align-start" onclick="filterStatus('${status}')">${status}</div>`;
        });
        
        dropdown.innerHTML = html;
    }

    function switchView(btn, viewName) {
      currentView = viewName;

      // Reset Tabs
      document.querySelectorAll('.tab-btn').forEach(b => {
        b.className = "tab-btn px-4 py-1 text-xs font-medium text-slate-500 dark:text-dark-muted hover:text-slate-700 dark:hover:text-white transition-colors";
      });
      // Active Tab
      btn.className = "tab-btn px-4 py-1 text-xs font-bold text-blue-600 dark:text-gnfc-orange bg-white dark:bg-[#323232] shadow-sm border border-slate-200 dark:border-dark-border rounded-sm transition-colors";

      // Update Header
      const titleMap = {
        'today': 'Today Log Book',
        'tomorrow': 'Tomorrow Log Book',
        'prev': 'Prev Day Log Book',
        'weekly': 'Weekly Log Book',
        'monthly': 'Monthly Log Book'
      };
      const dateMap = {
        'today': '06.02.2026',
        'tomorrow': '07.02.2026',
        'prev': '05.02.2026',
        'weekly': '30.01 - 06.02',
        'monthly': 'Feb 2026'
      };

      document.getElementById('view-title').innerText = titleMap[viewName];
      document.getElementById('view-date').innerText = dateMap[viewName];

      // Reset Filters
      document.getElementById('job-type-select').value = "";
      document.getElementById('start-date').value = "";
      document.getElementById('end-date').value = "";
      document.getElementById('table-search').value = ""; // Clear search input

      // Update Table Data
      plantLogTable.setData(plantLogData[viewName]);
      plantLogTable.setSearch(""); // Reset internal search state
    }

    // Init
    const dateEl = document.getElementById('current-date');
    if (dateEl) {
         const now = new Date();
         const options = { weekday: 'short', day: 'numeric', month: 'short', year: 'numeric' };
         dateEl.textContent = now.toLocaleDateString('en-GB', options);
    }

    function initReportNavState() {
      const navButtons = Array.from(document.querySelectorAll('.report-nav-btn[data-target]'));
      if (!navButtons.length) return;

      const currentFile = (window.location.pathname.split('/').pop() || '').toLowerCase();
      const lastSelected = (sessionStorage.getItem('plantDetailReportNav') || '').toLowerCase();
      let hasExactMatch = false;

      navButtons.forEach((btn) => {
        const target = (btn.dataset.target || '').toLowerCase();
        const isActive = target && target === currentFile;
        if (isActive) {
          btn.classList.add('is-active');
          btn.setAttribute('aria-current', 'page');
          hasExactMatch = true;
        } else {
          btn.classList.remove('is-active');
          btn.removeAttribute('aria-current');
        }

        btn.addEventListener('click', () => {
          sessionStorage.setItem('plantDetailReportNav', target);
        });
      });

      // On plant_detail page, keep the last visited report visually active.
      if (!hasExactMatch && currentFile === 'plant_detail.html' && lastSelected) {
        const remembered = navButtons.find((btn) => (btn.dataset.target || '').toLowerCase() === lastSelected);
        if (remembered) remembered.classList.add('is-active');
      }
    }

    // Init Logic
    document.addEventListener('DOMContentLoaded', () => {
        initReportNavState();
        initTable();
    });
    
  </script>
</body>

</html>
